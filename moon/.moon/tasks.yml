# https://moonrepo.dev/docs/config/tasks
$schema: "https://moonrepo.dev/schemas/tasks.json"

# Extend and inherit an external configuration file. Must be a valid HTTPS URL or file system path.
# extends: './shared/tasks.yml'

# File groups are a mechanism for grouping similar types of files within a project
# using file glob patterns. These groups are then used by tasks to calculate functionality like
# cache computation, affected files since last change, command line arguments, deterministic
# builds, and more.
#
# This setting requires a map, where the key is the file group name, and the value is a list of
# globs. Globs are relative to a project, even though they are defined globally. This enables
# enforcement of organizational patterns across all projects in the workspace.
fileGroups:
  sources:
    - "**/*.go"
    - "!**/*_test.go"
  tests:
    - "**/*_test.go"
  dockerfiles:
    - "dockerfiles/**/*"
  scripts:
    - "scripts/**/*"

tasks:
  install-go-tools:
    script: |
      $workspaceRoot/scripts/go-install.sh gotest.tools/gotestsum@v1.12.0
      $workspaceRoot/scripts/go-install.sh github.com/boumenot/gocover-cobertura@v1.2.0
      $workspaceRoot/scripts/go-install.sh github.com/golangci/golangci-lint/cmd/golangci-lint@v1.61.0
      $workspaceRoot/scripts/go-install.sh github.com/maykonlf/semver-cli/cmd/semver@v1.0.2
    inputs:
      - "@group(scripts)"
    platform: "system"
    options:
      mutex: go-tools

  version:
    script: |
      mkdir -p $workspaceRoot/artifacts
      $workspaceRoot/scripts/go-version.sh > $workspaceRoot/artifacts/VERSION
    inputs:
      - "@group(scripts)"
    platform: "system"
    options:
      mutex: go-version
